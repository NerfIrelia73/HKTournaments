<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<div class="modal-header bg-info" style="border-bottom: none;">
    <h4 class="modal-title" style="text-align: center;">Match Information</h4>
    <button type="button" class="close" aria-label="Close" (click)="activeModal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
<div class="modal-body bg-info">
    <div class="container" [ngStyle]="{'background-color': source.locked ? '#46b52a' : '#7a7a7a'}">
        <div class="row">
            <div class="col-sm-4">
                <div class="panelBox">
                    <span><strong>Runners</strong></span><br>
                    <span>{{ source.runners }}</span><br *ngIf="source.runners.length > 0">
                </div>
            </div>
            <div class="col-sm-4">
                <div class="panelBox">
                    <span><strong>Comms</strong></span><br>
                    <span *ngIf="adminInfo != null && !adminTournaments.includes(source.tournament) || source.locked">{{ source.comms }}</span><br *ngIf="source.comms.length > 0 && adminInfo != null && !adminTournaments.includes(source.tournament)">
                    <div style="font-size: 13px;">
                        <mat-form-field appearance="fill" *ngIf="adminInfo != null && adminTournaments.includes(source.tournament) && !source.locked && source.adminComms.length > 0">
                            <mat-label>Comms</mat-label>
                            <mat-select [formControl]="source.commsForm" multiple>
                                <mat-option *ngFor="let comm of source.adminComms" [value]="comm.id" selected>{{ comm.name }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <button mat-raised-button color="primary" *ngIf="!source.locked" (click)="sendToCalendar(source, 'comms', 'SignUp')">{{ this.adminInfo != null && !source.commsForm.value.includes(this.adminInfo.uid) ? 'Sign Up' : 'Cancel' }}</button>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="panelBox">
                    <span><strong>Restreamer</strong></span><br>
                    <span *ngIf="adminInfo != null && !adminTournaments.includes(source.tournament) || source.locked">{{ source.restreamer }}</span><br *ngIf="source.restreamer.length > 0 && adminInfo != null && !adminTournaments.includes(source.tournament)">
                    <div style="font-size: 13px;">
                        <mat-form-field appearance="fill" *ngIf="adminInfo != null && adminTournaments.includes(source.tournament) && !source.locked && source.adminRestreamer.length > 0">
                            <mat-label>Restreamer</mat-label>
                            <mat-select [formControl]="source.restreamerForm" multiple>
                                <mat-option *ngFor="let restreamer of source.adminRestreamer" [value]="restreamer.id" selected>{{ restreamer.name }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <button mat-raised-button color="primary" *ngIf="!source.locked" (click)="sendToCalendar(source, 'restreamer', 'SignUp')">{{ this.adminInfo != null && !source.restreamerForm.value.includes(this.adminInfo.uid) ? 'Sign Up' : 'Cancel' }}</button>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="panelBox">
                    <span><strong>Date</strong></span><br>
                    <span>{{ source.date }}</span>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="panelBox">
                    <span><strong>Confirmed</strong></span><br>
                    <span>{{ source.locked ? 'Yes' : 'No' }}</span>
                </div>
            </div>
        </div>
        <mat-divider></mat-divider>
        <mat-expansion-panel style="margin-top: 15px; width: 90%; margin-left: 20px; margin-bottom: 20px; background-color: #ffffff00; box-shadow: none;">
            <mat-expansion-panel-header [collapsedHeight]="'20px'" [expandedHeight]="'130px'">
                <div style="width: 100%; text-align: center;">
                    <strong><span>Additional Information</span></strong>
                </div>
            </mat-expansion-panel-header>

            <div class="panelContainer">
                <div class="panelBox" style="text-align: left;">
                    <span *ngFor="let runner of source.participantInfo" style="display: block; margin-bottom: 4px;">{{ runner }}</span><br>
                </div>
                <div class="panelBox" style="text-align: left;">
                    <span *ngFor="let command of source.commands" style="display: block; margin-bottom: 4px;">{{ command }}</span><br>
                    <span style="display: block; margin-bottom: 4px;">Discord Timestamp: {{ source.timestamp }}</span><br>
                </div>
            </div>
            <div class="panelContainer" *ngIf="adminInfo != null && adminTournaments.includes(source.tournament) && selectedTournaments.includes(source.tournament)">
                <span style="font-size: 18px; margin-right: 15px; margin-top: 8px;"><strong>Match Title: </strong></span>
                <input type="text" class="login__input" [formControl]="source.matchTitle">
                <button (click)="sendToCalendar(source, null, 'title')" style="height: 50%;margin-left: 15px;" mat-raised-button color="success">Save</button>
            </div>
        </mat-expansion-panel>
        <!--
        <mat-expansion-panel style="width: 90%; margin-left: 20px; margin-bottom: 20px;" [ngStyle]="{'background-color': source.locked ? '#46b52a' : '#7a7a7a'}">
            <mat-expansion-panel-header [collapsedHeight]="'130px'" [expandedHeight]="'130px'">
                <div class="panelContainer">
                    <div class="panelBox">
                        <span><strong>Runners</strong></span><br>
                        <span>{{ source.runners }}</span><br *ngIf="source.runners.length > 0">
                    </div>
                    <div class="panelBox">
                        <span><strong>Comms</strong></span><br>
                        <span *ngIf="adminInfo != null && !adminTournaments.includes(source.tournament) || source.locked">{{ source.comms }}</span><br *ngIf="source.comms.length > 0 && adminInfo != null && !adminTournaments.includes(source.tournament)">
                        <div style="font-size: 13px;">
                            <mat-form-field appearance="fill" *ngIf="adminInfo != null && adminTournaments.includes(source.tournament) && !source.locked && source.adminComms.length > 0">
                                <mat-label>Comms</mat-label>
                                <mat-select [formControl]="source.commsForm" multiple>
                                    <mat-option *ngFor="let comm of source.adminComms" [value]="comm.id" selected>{{ comm.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <button mat-raised-button color="primary" *ngIf="!source.locked" (click)="toggleSignUp('comms', source)">{{ this.adminInfo != null && !source.commsForm.value.includes(this.adminInfo.uid) ? 'Sign Up' : 'Cancel' }}</button>
                    </div>
                    <div class="panelBox">
                        <span><strong>Restreamer</strong></span><br>
                        <span *ngIf="adminInfo != null && !adminTournaments.includes(source.tournament) || source.locked">{{ source.restreamer }}</span><br *ngIf="source.restreamer.length > 0 && adminInfo != null && !adminTournaments.includes(source.tournament)">
                        <div style="font-size: 13px;">
                            <mat-form-field appearance="fill" *ngIf="adminInfo != null && adminTournaments.includes(source.tournament) && !source.locked && source.adminRestreamer.length > 0">
                                <mat-label>Restreamer</mat-label>
                                <mat-select [formControl]="source.restreamerForm" multiple>
                                    <mat-option *ngFor="let restreamer of source.adminRestreamer" [value]="restreamer.id" selected>{{ restreamer.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <button mat-raised-button color="primary" *ngIf="!source.locked" (click)="toggleSignUp('restreamer', source)">{{ this.adminInfo != null && !source.restreamerForm.value.includes(this.adminInfo.uid) ? 'Sign Up' : 'Cancel' }}</button>
                    </div>
                    <div class="panelBox">
                        <span><strong>Date</strong></span><br>
                        <span>{{ source.date }}</span>
                    </div>
                    <div class="panelBox">
                        <span><strong>Confirmed</strong></span><br>
                        <span>{{ source.locked ? 'Yes' : 'No' }}</span>
                    </div>
                </div>
            </mat-expansion-panel-header>

            <div class="panelContainer">
                <div class="panelBox" style="text-align: left;">
                    <span *ngFor="let runner of source.participantInfo" style="display: block; margin-bottom: 4px;">{{ runner }}</span><br>
                </div>
                <div class="panelBox" style="text-align: left;">
                    <span *ngFor="let command of source.commands" style="display: block; margin-bottom: 4px;">{{ command }}</span><br>
                </div>
            </div>
        </mat-expansion-panel>
        -->
    </div>
    <div class="container" style="background-color: #0000ff00;">
        <div class="row">
            <button (click)="sendToCalendar(source, null, 'confirm')" style="margin-top: 10px; height: 50%; margin-top: 32px; margin-left: 15px;" mat-raised-button color="success" *ngIf="adminInfo != null && adminTournaments.includes(source.tournament)">{{ source.locked ? 'Unconfirm Match' : 'Confirm Match' }}</button>
            <button (click)="sendToCalendar(source, null, 'delete')" style="margin-top: 10px; height: 50%; margin-top: 32px; margin-left: 15px;" mat-raised-button color="warn" *ngIf="adminInfo != null && ((adminTournaments.includes(source.tournament)) || source.runnerIds.includes(adminInfo.uid))" [disabled]="source.locked">Delete Match</button>
            <button (click)="sendToCalendar(source, null, 'reset')" style="margin-top: 10px; height: 50%; margin-top: 32px; margin-left: 15px;" mat-raised-button color="primary" *ngIf="adminInfo != null && adminTournaments.includes(source.tournament)" [disabled]="source.locked">Undo Changes</button>
            <button (click)="sendToCalendar(source, null, 'HKC')" style="margin-top: 10px; height: 50%; margin-top: 32px; margin-left: 15px;" mat-raised-button [color]="source.onHKC ? 'success' : 'warn'" *ngIf="adminInfo != null && adminTournaments.includes(source.tournament)">{{ source.onHKC ? 'On Calendar' : 'Not on Calendar'}}</button>
        </div>
    </div>
</div>